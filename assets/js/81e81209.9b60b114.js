(self.webpackChunkcloud_docs=self.webpackChunkcloud_docs||[]).push([[759],{7636:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return r},metadata:function(){return a},toc:function(){return c},default:function(){return u}});var o=t(2122),i=t(9756),l=(t(7294),t(3905)),s=["components"],r={sidebar_position:2},a={unversionedId:"cloud-functions/models",id:"cloud-functions/models",isDocsHomePage:!1,title:"Models",description:"function overview",source:"@site/docs/cloud-functions/models.md",sourceDirName:"cloud-functions",slug:"/cloud-functions/models",permalink:"/cloud-docs/docs/cloud-functions/models",editUrl:"https://github.com/sirius-400/cloud-docs/edit/main/website/docs/cloud-functions/models.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Firestore Scheduler",permalink:"/cloud-docs/docs/cloud-functions/firestoreScheduler"},next:{title:"AI Platform Setup",permalink:"/cloud-docs/docs/ai-platform"}},c=[{value:"Index File",id:"index-file",children:[]},{value:"Package file",id:"package-file",children:[]},{value:"ESLint Config",id:"eslint-config",children:[]},{value:"Create .gcloudignore file",id:"create-gcloudignore-file",children:[]},{value:"Create .gitignore file",id:"create-gitignore-file",children:[]},{value:"Deploy your functions",id:"deploy-your-functions",children:[]}],d={toc:c};function u(e){var n=e.components,r=(0,i.Z)(e,s);return(0,l.kt)("wrapper",(0,o.Z)({},d,r,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"function overview",src:t(3491).Z})),(0,l.kt)("p",null,"This functions is the one that we use for serve model output retrived from cloud storage. This functions will respond to ",(0,l.kt)("inlineCode",{parentName:"p"},"GET")," request and return a JSON of the model output."),(0,l.kt)("h2",{id:"index-file"},"Index File"),(0,l.kt)("p",null,"Create ",(0,l.kt)("inlineCode",{parentName:"p"},"index.js")," and write these code,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="index.js"',title:'"index.js"'},'const {Storage} = require("@google-cloud/storage");\nconst BUCKET_NAME = "YOUR_BUCKET_NAME";\nconst storage = new Storage();\nconst fs = require("fs");\n\nexports.models = async (request, response) => {\n  if (request.method === "GET") {\n   const filePath = "data/";\n   const fileName = "output-latest.json";\n   const bucket = storage\n     .bucket(BUCKET_NAME);\n   const source = `${filePath}${fileName}`;\n\n   try {\n   // Download file from the bucket\n    await bucket.file(source).download({\n     destination: "/tmp/output-latest.json",\n     validation: "crc32c",\n    });\n\n    const content = fs.readFileSync("/tmp/output-latest.json");\n    response.status(200).send(JSON.parse(content));\n   } catch (e) {\n    response.status(500).send("Error on request, please check log");\n    console.log(e);\n   }\n  } else {\n   return response.status(403).send("Forbidden!");\n  }\n };\n')),(0,l.kt)("h2",{id:"package-file"},"Package file"),(0,l.kt)("p",null,"This is my ",(0,l.kt)("inlineCode",{parentName:"p"},"package.json")," file used to build this functions"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:"title=package.json",title:"package.json"},'{\n  "name": "model",\n  "version": "1.0.0",\n  "description": "",\n  "scripts": {\n    "lint": "eslint ."\n  },\n  "main": "index.js",\n  "dependencies": {\n    "@google-cloud/firestore": "4.12.2",\n    "@google-cloud/functions-framework": "^1.8.0",\n    "@google-cloud/storage": "^5.8.5",\n    "json-2-csv": "^3.14.0",\n    "semver": "^5.5.1"\n  },\n  "devDependencies": {\n    "babel-eslint": "^10.1.0",\n    "eslint": "^7.6.0",\n    "eslint-config-google": "^0.14.0"\n  }\n}\n')),(0,l.kt)("h2",{id:"eslint-config"},"ESLint Config"),(0,l.kt)("p",null,"Enable ESLint to lint your javascript code"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=.eslintrc.js",title:".eslintrc.js"},'# This file specifies files that are *not* uploaded to Google Cloud Platform\n# using gcloud. It follows the same syntax as .gitignore, with the addition of\n# "#!include" directives (which insert the entries of the given .gitignore-style\n# file at that point).\n#\n# For more information, run:\n#   $ gcloud topic gcloudignore\n#\n.gcloudignore\n# If you would like to upload your .git directory, .gitignore file or files\n# from your .gitignore file, remove the corresponding line\n# below:\n.git\n.gitignore\napackage.json\nindex_bak.js\nnode_modules/\n\n#!include:.gitignore\n')),(0,l.kt)("h2",{id:"create-gcloudignore-file"},"Create .gcloudignore file"),(0,l.kt)("p",null,"Create this file to ignore what file to be uploaded."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'# This file specifies files that are *not* uploaded to Google Cloud Platform\n# using gcloud. It follows the same syntax as .gitignore, with the addition of\n# "#!include" directives (which insert the entries of the given .gitignore-style\n# file at that point).\n#\n# For more information, run:\n#   $ gcloud topic gcloudignore\n#\n.gcloudignore\n.git\n.gitignore\napackage.json\nindex_bak.js\nnode_modules/\n\n#!include:.gitignore\n')),(0,l.kt)("h2",{id:"create-gitignore-file"},"Create .gitignore file"),(0,l.kt)("p",null,"Create this file to ignore what file to be uploaded."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text",metastring:"title=.gitignore",title:".gitignore"},"node_modules/\n*.log\n")),(0,l.kt)("h2",{id:"deploy-your-functions"},"Deploy your functions"),(0,l.kt)("p",null,"Deploy your functons on the cloud using ",(0,l.kt)("inlineCode",{parentName:"p"},"gcloud")," command,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud functions deploy models --trigger-http --runtinme=nodejs14 --region=asia-southeast2\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Thats it! Your functions are good to go!")))}u.isMDXComponent=!0},3491:function(e,n,t){"use strict";n.Z=t.p+"assets/images/overview-2250667b3c0278e9f1ead1175315b639.png"}}]);